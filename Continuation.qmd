# Forking the project

Now that you have your GitHub account setup, it is time to use it. Our version of the dashboard is contained within the [InstrumentQC](https://github.com/UMGCCFCSS/InstrumentQC) repository. This is publicly available, and given the software repository is licensed under a free copyleft license, you are able to fork (ie. copy) the existing project and modify it.

To do so, you will first navigate to the [InstrumentQC](https://github.com/UMGCCFCSS/InstrumentQC) repository. From here you will select [the fork the repository option]{.underline}

![](images/01_Fork.png){fig-align="center" width="600"}

GitHub will then give you the option to rename the project or to keep the existing name. If you modify the name, there may be a couple additional lines of code you will need to modify later on, but that would be minor enough so don't let that stop you if you hate the existing name.

![](images/02_Fork.png){fig-align="center" width="600"}

You now have your own copy of the repository that you can modify to generate a dashboard that is customized to your instruments. Please make a note of your forked repositories url as you will need it when setting up the project locally with Rstudio in a little bit.

![](images/03_Fork.png){fig-align="center"}

# Rstudio and GitHub

Open up Rstudio for the first time, and set to use the default R installation.

The first order of business is making sure we have Rstudio set up to communicate with GitHub through git. We will first install the devtools package. Once this is done, navigate to terminal and set the following for user email and username to match that of your GitHub account.

Navigate back to your GitHub account, click on your profile icon on the far upper right, and then [select settings]{.underline}

![](images/01_GitToken.png){fig-align="center" width="600"}

From here, you will navigate to the lower left side and click on developer settings

![](images/02_GitToken.png){fig-align="center" width="260"}

Once you are on the next page, you will select [Tokens (classic) option]{.underline}

![](images/03_GitToken.png){fig-align="center" width="600"}

From there, you will now proceed to click on [Generate new token and select the classic option]{.underline}

![](images/04_GitToken.png){fig-align="center"}

On the next screen, things get busy. Go ahead and place a note for the token with the instrument name so you know which match with each other. Set the expiration for no expiration or a long-period, and only click on the repo option to grant those accesses. Proceed down to the bottom of the screen and click on the green generate token button.

![](images/05_GitToken.png){fig-align="center" width="600"}

The website will refresh and provide you a GitHub token and the option to copy it. Copy it and temporarily store it in a .txt file (notepad) as you will need it when setting up the connection between Github and Rstudio. You will not be able to see the code again from this screen, so stash wisely, and be cautious not to store this anywhere that others may find it.

![](images/06_GitToken.png){fig-align="center"}

You will now navigate to Rstudio, where you will enter the code.... steps.... You will also go ahead and save as an Renviron variable with additional details explaining why to be provided later.

With Rstudio and GitHub now communicating with each other, it is time to bring a copy of your forked InstrumentQC repository into Rstudio (and the local computer environment more broadly).

To do this, after opening Rstudio, navigate to the upper left corner to the File tab and select [create a New Project]{.underline}

![](images/01_NewProject.png){fig-align="center" width="600"}

From here, you will select the [Version Control]{.underline} option

![](images/02_NewProject.png){fig-align="center" width="600"}

You will next select to [use the Git option]{.underline}

![](images/03_NewProject.png){fig-align="center" width="600"}

And now you will p[rovide the url to the forked repository,]{.underline} ie. the version on your own GitHub. The Project directory will autopopulate.

Before hitting Create Project, make note of where the project is set to be saved at by hitting browse.

In general, for many windows computers, it will be under the document folder, which should be fine. Alternatively, if your workplace forces everyone to save things on OneDrive, the default folder may be somewhere in the cloud. Ideally, try to store it on the local computer to avoid complicating the file.path setup in the next section, so if in a OneDrive scenario, create a new folder under the local C: drive and save it within that folder.

Once you know where you are saving the project to, hit Create Project.

![](images/04_NewProject.png){fig-align="center" width="600"}

With all that done, you now have the project and all it's associated code available locally.

Once this is done, open the file and verify that you can open edit the contents.

The next steps are to install required R packages needed to execute the code. Most of these are available through either Bioconductor or CRAN repositories. The one exception is our R package Luciernaga that host some of the dashboard functions, that is currently only available via GitHub. To install, follow the following workflow.

Finally, verify connection is working by saving your changes by commiting, write a commit message, and push to your repository. Navigate to the website and confirm the update has moved.

# Setting up Locally

Within the InstrumentQC data, there is a data folder with individual archive folders for each instrument. Modify the names accordingly for your own setting. Within the archived folder, delete the existing files that contain our institutions data.

Next, you will need to modify the existing Rscript to match the following names, and to point at the Cytekbio Setup folder containing the DailyQC files and to the folder containing the bead .fcs files used as part of the MFI monitoring. Make sure these are correct.

Now, on the upper right hand side, hit the Source option. This should trigger the processing of the entire R script needed to process the past data. If it fails, you will need to troubleshoot whether the file.path your provided is the correct one (most likely error) or an R package dependency is missing (in which case it would need to be installed).

Once complete, you should see the processed data is now present within the Archive folder.

Open up the equivalent .qmd file for your given instrument. This file is what will build the dashboard for the equivalent instrument page on the website. Make sure to similarly modify the file.paths at the top of the file so they match your Archive folder for that project. Once done, hit render button and wait, troubleshooting as needed. Both R script and .qmd will be specific and search for the data within those folders, so we anticipate less issues.

Once done, either a browser window will open showing the data for the instrument, or you will need to go to InstrumentQC, docs folder and open the index.html file to see a local rendered version of the file. Once you are here, congratulations, the basic install for your instrument has been carried out successfully. Repeat for the other instruments for the time being.

# Automating Transfer

Now that the initial set up of InstrumentQC data folder with archive data, and the R script QMD file paths are sorted, its time to figure out how to produce new data. One way of doing this would be to do so manually. We provide examples of a staff.qmd file where once you set up the filepath to the Rscript, you only need to hit the Run Current Code chunk to automatically process any new data.

An alternative is to go for an automated approach. This relies on the Windows Task Scheduler, that sets when updates are run. Our institution the QC is generally done on our instruments by 10:30 AM, so we set the task scheduler to go for that time. Likewise, if manually been done before this point, it produces a flag profile that skips processing the data again. This flag file gets eliminated later in the day, and an update is pulled in at 6 AM to reduce processing time during peak hours.

Regardless of approach, ultimately you end up with new processed data. These changes are tracked by Git as part of version control. These in turn can be pushed to GitHub which provides the processed data to where the main computer or github action needed to render the dashboard can have access to it. We will also when setting up taskscheduler set them to two minutes apart to avoid having issues with the pull push versions when transferring.

# Building the Dashboard

Now that we have the individual instruments setup and transferring the data to GitHub, let's talk dashboard website structure. The plots we can see locally in the .qmd file get rolled out as their own interactive webpage. If your instrument has additional parameters, by delving into the code you can modify what gets included or excluded. It helps to have someone with R experience to help with this customization if you are unfamiliar. R is your playground, you can customize what gets included in a Quarto document for practically anytime if you invest the time.

The combination of each instruments .qmd file forms the websites main pages. The additional pages in our example are index.qmd that forms the home page, which also has the R code needed to access all the data across instruments archive data to provide the summary visual and the 6 month history. Make sure the file paths are updated here accordingly or it will fail out.

Additional .qmd files for help and data are present rendering mostly independently of each other. All the above individual pages are cobbled together into the overall website by means of the \_yaml file.

To begin, you can start locally by navigating to terminal, and quarto render the project folder. This will generate the local version. You can then git commit all the generated html files and push to GitHub.

Next, navigate to GitHub, navigate to the repositories settings and set the page to be visualized from the main branch and the docs folder. Wait three minutes, and then navigate to the username.github.io/InstrumentQC style url to visualize your dashboard. Repeat edits to the code and pushes until you have it customized to how you want the visual apperance.

# Github Actions

Rendering locally takes computer time. Additionally, it means each instrument needs to bring in edited versions of the website locally every morning with their initial pull. Alternatively, we can set up a github-pages branch where the rendered website remains on the web and not on the local computer, and customize a Github Actions at the repository level that will spin up a Cloud instance to generate the website. This is free for public github repositories up to certain allowances that our website doesn't approach with a once daily frequency. The flip-side is it's more complicated technical and can take longer due to needing to install R and the R packages needed to run everything on the cloud instance each time. For those with R experience or who laugh in face of danger, read on.
